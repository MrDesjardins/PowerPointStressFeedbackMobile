@using Newtonsoft.Json
@model PowerPointStressFeedbackWeb.Controllers.MergedData

@if (Model == null)
{
    <h1>No data, provide a session id</h1>
}
else
{
    <h1>Data from session id : @Model.SessionId</h1>

    <div id="container" style="min-width: 310px; height: 400px; margin: 0 auto"></div>

    <script>
        @{
            var data = JsonConvert.SerializeObject(Model.Data);
        }
        var data = @Html.Raw(data);




        $(document).ready(
            function() {

                //Build 2 array. One for the average, one for the range
                var heartBeatRange = [];
                var heartBeatAverage = [];
                var temperatureAverage = [];
                var slides = [];
                for(var i=0;i<data.length;i++)
                {
                    slides.push(data[i].SlideIndex);
                    heartBeatRange.push([data[i].HeartBeatMinimum, data[i].HeartBeatMaximum]);
                    heartBeatAverage.push(data[i].HeartBeatAverage);
                    temperatureAverage.push(data[i].Temperature);
                }

                //http://api.highcharts.com/highcharts#tooltip
                $('#container').highcharts({
                    chart: {
                        zoomType: 'xy'
                    },
                    title: {
                        text: 'Power Point Stress Feedback : Heart Beat and Skin Temperature'
                    },
                    xAxis: [{
                        categories: slides

                    }],
                    yAxis: [{ // Primary yAxis
                            title: {
                                text: 'Heart Beat',
                                style: {
                                    color: Highcharts.getOptions().colors[1]
                                }
                            },
                            labels: {
                            format: '{value} bpm',
                            style: {
                                color: Highcharts.getOptions().colors[1]
                            }
                        }
                    }, { // Secondary yAxis
                        title: {
                            text: 'Body Temperature',
                            style: {
                                color: 'rgba(255,155,0,1)'
                            }
                        },
                        labels: {
                            format: '{value} °C',
                            style: {
                                color: 'rgba(255,155,0,1)'
                            }
                        },
                        opposite: true,
                        min:36,
                        max:38,
                        tickInterval:0.05
                    }],

                    tooltip: {
                        shared: true,
                        headerFormat: '<small>Slide {point.key}</small><br/>'
                    },

                    series: [{
                        name: 'Body Temperature',
                        type: 'column',
                        yAxis: 1,
                        data: temperatureAverage,
                        color: 'rgba(255,155,0,0.1)',
                        tooltip: {
                        pointFormat: '<span style="font-weight: bold; color: rgba(255,155,0,1)">{series.name}</span>: <b>{point.y:.1f} °C</b><br/>'
                        }
                    }, {
                        name: 'Heart Beat Average',
                        type: 'spline',
                        data: heartBeatAverage,
                        tooltip: {
                            pointFormat: '<span style="font-weight: bold; color: {series.color}">{series.name}</span>: <b>{point.y} bpm</b><br/>'
                        }
                    }, {
                        name: 'Heart Beat Min-Max',
                        type: 'errorbar',
                        data: heartBeatRange,
                        tooltip: {
                            pointFormat: '(Min-Max: {point.low}-{point.high} bpm)<br/>'
                        }
                    }]
                });

          
        });
    </script>
}

